# 문제 (05.04)

## 1. socket 통신

```java
package day30.quiz;


import java.io.BufferedWriter;
import java.io.IOException;
import java.util.Scanner;

import javax.swing.JOptionPane;

public class Quiz02SendingThread extends Thread{
	
	BufferedWriter bw;
	String name;
	String msg;
	boolean check = false;

	public Quiz02SendingThread(BufferedWriter bw, String name) {
		this.bw = bw;
		this.name = name;
	}
	
	public boolean getterCheck() {
		return check;
	}
	
	
	@Override
	public void run() {
		while(!isInterrupted()) {
			
			try {

				msg = JOptionPane.showInputDialog("하고싶은 말");
				if("exit".equalsIgnoreCase(msg)) {
					check = true;
					System.out.println(check);
					break;
				}
				
				bw.write(msg+"\n");
				bw.flush();
			} catch (Exception e) {
				
			}
		}
			

	}

}
```

```java
package day30.quiz;

import java.io.BufferedReader;
import java.io.IOException;

public class Quiz02ReceiveThread extends Thread {
	
	BufferedReader br;
	String name;
	String msg;
	int i;
	
	Quiz02ReceiveThread(BufferedReader br, String name){
		this.br = br;
		this.name = name;
	}
	
	@Override
	public void run() {
		try {
			while(!isInterrupted()) {
				
				while((msg = br.readLine())!= null) {
					System.out.println(String.format("%s 읽다 : %s", name,msg));
				}
			}
			
		} catch (IOException e ) {
			
		}
	}

}

```

```java
package day30.quiz;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.net.ServerSocket;
import java.net.Socket;

public class Quiz02Server {
	
	
	public Quiz02Server() {
		
		ServerSocket sSocket = null;
		Socket socket = null;
		
		BufferedReader br = null;
		BufferedWriter bw = null;
		
		try {
		
			sSocket = new ServerSocket(5000);
			
			while(true) {
				socket = sSocket.accept();
				
				System.out.println("연결된 Client : "+ socket.getInetAddress());
				
				bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
				br = new BufferedReader(new InputStreamReader(socket.getInputStream()));
				
				Quiz02SendingThread ss = new Quiz02SendingThread(bw, "서버");
				Quiz02ReceiveThread sr = new Quiz02ReceiveThread(br, "서버");
				
				ss.start();
				sr.start();
				while(!ss.getterCheck()) {}
				ss.interrupt();
				sr.interrupt();
				
				break;
				
			}
			
			
		} catch (Exception e) {
			
		}finally {
			try {
				if (bw != null) bw.close();
				if (br != null) br.close();
				if (socket != null) socket.close(); 
				System.out.println("끝");
			} catch (Throwable e) {
				
			}
		}
		
	}
	public static void main(String[] args) {
		System.out.println("---- Server 실행 ----");
		new Quiz02Server();
		System.out.println("---- Server 종료 ----");
	}
}

```

```java
package day30.quiz;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.net.Socket;

public class Quiz02Client {

	public Quiz02Client() {
		Socket socket = null;
		
		BufferedReader br = null;
		BufferedWriter bw = null;
		
		try {
			socket = new Socket("127.0.0.1",5000);
			System.out.println("서버와 연결됨.");
			
			bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
			br = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			
			Quiz02SendingThread cs = new Quiz02SendingThread(bw, "클라이언트");
			Quiz02ReceiveThread cr = new Quiz02ReceiveThread(br, "클라이언트");
			cs.setDaemon(true);
			cr.setDaemon(true);
			cs.start();
			cr.start();
			
			while(!cs.getterCheck()) {}
			System.out.println("인터럽트 걸어");
			cs.interrupt();
			cr.interrupt();
		}catch (IOException e) {
			// TODO: handle exception
		}finally {
			try {
//				if (bw != null) bw.close();
//				if (br != null) br.close();
//				if (socket != null) socket.close(); 
//				System.out.println("끝");
			} catch (Exception e2) {
				// TODO: handle exception
			}
		}
	}
	
	public static void main(String[] args) {
		System.out.println("---- Client 실행 ----");
		new Quiz02Client();
		System.out.println("---- Client 종료 ----");
	}

}

```

